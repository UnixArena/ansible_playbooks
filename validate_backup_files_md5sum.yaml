---
- hosts: localhost 
  gather_facts: yes
  var: 
    MD5CHECK
      - 2
  tasks:
  - name: Backup the config files before editing it
    shell: |  
       cp /etc/hosts /var/tmp/hosts.bak.{{ansible_date_time.date}}
       cp /etc/nsswitch.conf /var/tmp/nsswitch.conf.bak.{{ansible_date_time.date}}

  - name: Valdiate the backup files using md5 checksum 
    command: md5sum "{{ item.orig }}" "{{ item.backup }}" | unique | wc -l 
    with_items:
      - { orig: '/etc/hosts', backup: '/var/tmp/hosts.bak.{{ansible_date_time.date}}'}
      - { orig: '/etc/nsswitch.conf', backup: '/var/tmp/nsswitch.conf.bak.{{ansible_date_time.date}}'}
      - { orig: '/etc/nsswitch.conf', backup: '/var/tmp/hosts.bak.{{ansible_date_time.date}}'}
    register: MD5

  - debug: 
      msg: Backup files integrity is failed 
    with_items: " {{ MD5.results }} in  MDCHECK "
